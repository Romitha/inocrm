- products = @products
- cached_products = @cached_products
%br/
- if products.present?
  = paginate products, remote: true, method: :get

  = form_tag submit_selected_products_contracts_path(from_where: params[:from_where]), method: :post, remote: true do
    - if params[:from_where] == "cus_product"
      = submit_tag "Done", :name => "done_cus_product", class: "btn btn-sm btn-success btn-primary"
    - else
      = submit_tag "Done", :name => "done", class: "btn btn-sm btn-success btn-primary"

    .row
      %table.table.table-hover
        %thead
          %tr
            %th No
            %th Serial No
            %th Model No
            %th Product No
            %th Product
            %th Brand
            %th Customer Name
            %th Hold
            %th Active
            %th Action
        %tbody
          - products.each_with_index do |p, index|
            %tr
              %td
                - if params[:page]
                  = (index+1)+ 5*(params[:page].to_i-1)
                - else
                  = (index+1)
              %td= p.serial_no
              %td= p.model_no
              %td= p.product_no
              %td= p.category_name
              %td= p.brand_name
              - if p.ticket_contracts.present?
                - if p.ticket_contracts.last.present?
                  %td= p.ticket_contracts.last.organization.try(:name)
                  %td= boolean_in_word p.ticket_contracts.last.try(:hold), "Yes", "No"
                  %td
              - else
                %td= p.owner_customer.try(:name)
                %td
                %td
              / %td= link_to "Select"


              %td
                - if params[:from_where] == "cus_product"
                  = check_box_tag "serial_products_ids[]", p.id, Rails.cache.fetch([:products, request.remote_ip]).to_a.map { |e| e.id }.include?(p.id.to_f)
                - else
                  = check_box_tag "serial_products_ids[]", p.id, Rails.cache.fetch([:contract_products, request.remote_ip]).to_a.map { |e| e.id }.include?(p.id.to_f)
              / %td= check_box_tag "serial_products_ids[]", p.id
  = paginate products, remote: true, method: :get