- tapbar = [["Address", "#addresses#{organization.id}"], ["#{[Organization::TYPES[1], Organization::TYPES[3]].include?(organization.category) ? 'Contact Persons' : 'Employees'}", "#contact_persons#{organization.id}"], ["Documents & Attachements", "#documents#{organization.id}"], ["Designations", "#designations#{organization.id}"], ["Organization Relations", "#organization_relations#{organization.id}"], ["Roles and Permissions", "#roles_and_permissions#{organization.id}"], ["Dealer Types", "#dealer_types#{organization.id}"]]

= simple_nested_form_for organization, html: {class: "validate_form"} do |f|
  - if organization.errors.present?
    .row
      = panels header_content: "Something gone wrong", panel_type: "danger" do
        %ul
          - organization.errors.full_messages.each do |message|
            %li= message
  .row
    .col-md-1
      = image_tag organization.logo.url, class: "img-responsive" if organization.logo.present?
      .btn.btn-success.btn-file.has-tooltip{data: {toggle: "tooltip", placement: "left"}, title: "Upload organization Logo"}
        = f.input :logo, as: :file, label: "Upload Logo", placeholder: "Upload organization Logo", wrapper_html: {class: "margin-none"}

      .organization_attachment_wrapper

      %script#organization_attachment_upload_tmpl{type: "text/x-tmpl"}
        .organization_logo_upload.span12
          {%= o.name %}
          .progress
            .progress-bar.progress-bar-success.progress-bar-striped{role: "progressbar", "aria-valuemax" => 100, "aria-valuemin" => 0, "aria-valuenow" => 0}


    .col-md-10.pull-right
      - if params[:category].to_s[0..2] == "IND"
        = f.label "Title ", {style: "color: #900303;"}
        = f.select :title_id, MstTitle.all.uniq{|t| t.id}.map{|o| [o.title, o.id]}, {required: true}

      = f.input :name, placeholder: "Name of Organization / Business", input_html: {class: "has-tooltip", data: {toggle: "tooltip", placement: "left"}, title: "Organization/Business Name"}
      / %blockquote
      = f.input :short_name, placeholder: "Short name of Organization / Business", input_html: {class: "has-tooltip", data: {toggle: "tooltip", placement: "left"}, title: "Short name of Organization / Business"}
  .row
    - unless Organization::TYPES[2,3].include?(organization.category)
      .col-md-4
        = f.input :vat_number, placeholder: "Vat Number", input_html: {class: "has-tooltip", data: {toggle: "tooltip", placement: "left"}, title: "Vat Number"}
    .col-md-4
      = f.association :organization_type, include_blank: false
    .col-md-4.pull-right
      = f.input :web_site, placeholder: "Web Site", input_html: {class: "has-tooltip", data: {toggle: "tooltip", placement: "left"}, title: "Web Site"}

  - f.object.build_account if !f.object.account.present? and f.object.refers != "VSIS"
  = f.simple_fields_for :account do |a|
    .row
      .col-md-12{class: "has-tooltip", title: "Industry type", data: {toggle: "tooltip", placement: "left"}}
        = a.association :industry_type, include_blank: false

  .row
    .col-md-12
      = f.input :description, placeholder: "Description", input_html: {class: "has-tooltip", data: {toggle: "tooltip", placement: "left"}, title: "Description"}
      = hidden_field_tag :category, params[:category] 

  .row
    .col-md-12
      .pull-right
        = f.submit "Save", class: "btn btn-success"

  %br

- if organization.persisted?
  .row
    .col-md-12
      %ul.nav.nav-tabs{role: "tablist"}
        - tapbar.each do |link_info|
          - if tapbar[5]==link_info or tapbar[7] == link_info
            %li= link_to link_info[0], link_info[1], role: "tab", data: {toggle: "tab"} unless(Organization::TYPES[2,3].include?(organization.category))
          - elsif tapbar[7]==link_info
            %li= link_to link_info[0], link_info[1], role: "tab", data: {toggle: "tab"} if organization.refers=="VSIS"
          - else
            %li= link_to link_info[0], link_info[1], role: "tab", data: {toggle: "tab"}

  .tab-content.small_scale_margin-top1

    .tab-pane.limit-height{id: "addresses#{organization.id}"}
      / .row
      /   - organization.customers.each do |customer|
      /     .col-md-6
      /       = render "contact", customer: customer if customer.persisted?
      / = render "contact_form", organization: organization
      = render "addresses/form", address: organization.addresses.build
      - organization.addresses.order("created_at DESC").each do |address|
        = render "addresses/address", address: address if address.persisted?

    .tab-pane.limit-height{id: "contact_persons#{organization.id}"}
      = link_to "Add Employee", new_user_path(organization_id: encrypt_org(organization.id)), class: "btn btn-primary btn-sm small_scale_margin-bottom1"
      .limit-height
        - organization.employees.each do |user|
          = render "users/user", user: user

    .tab-pane.limit-height{id: "designations#{organization.id}"}
      = render "designations/form", designation: organization.designations.build

      - organization.designations.order("created_at DESC").each do |designation|
        = render "designations/designation", designation: designation

    .tab-pane.limit-height{id: "documents#{organization.id}"}
      = render "document_attachments/form", document_attachment: organization.document_attachments.build
      .fixed-height
        #autoloadable_prepend
        - organization.document_attachments.order("created_at DESC").each do |document_attachment|
          = render "document_attachments/documents_attachments", document_attachment: document_attachment

    - unless Organization::TYPES[2,3].include?(organization.category)
      .tab-pane.limit-height{id: "organization_relations#{organization.id}"}
        #org_members
          = render "organizations/members", organizations: organization.members
        = render "organizations/parent_member", parent_member: organization

    - if organization.refers == "VSIS"
      .tab-pane.limit-height{id: "roles_and_permissions#{organization.id}"}
        .fixed-height
          = link_to "Add Roles and set Permissions", new_organization_roles_and_permission_path(organization), class: "btn btn-primary btn-sm small_scale_margin-bottom1"
          - organization.roles.order("created_at DESC").each do |role|
            = render "roles_and_permissions/role", role: role

    - unless organization.refers == "VSIS"
      .tab-pane.limit-height{id: "dealer_types#{organization.id}"}
        = render "dealer_types/form", organization: organization

      / - organization.accounts_dealer_types.order("created_at DESC").each do |accounts_dealer_type|
      /   = render "dealer_types/dealer_type", dealer_type: accounts_dealer_type