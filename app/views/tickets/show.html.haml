- ticket = @ticket
- product = @product
- warranties = product.warranties
- customer = ticket.customer
- histories = @histories
- join_tickets = @join_tickets
- pr_q_and_answers = ticket.q_and_answers.group_by{|a| a.q_and_a && a.q_and_a.task_action.action_description}.inject({}){|hash, (k,v)| hash.merge(k => {"Problematic Questions" => v})}
- ge_q_and_as = ticket.ge_q_and_answers.group_by{|ge_a| ge_a.ge_q_and_a && ge_a.ge_q_and_a.task_action.action_description}.inject({}){|hash, (k,v)| hash.merge(k => {"General Questions" => v})}

.view_ticket_header
  .row.margin-none.bg-info
    .fixed
      .col-md-5.small_scale_padding-top8
        Ticket No :#{ticket.ticket_no.to_s.rjust(6, INOCRM_CONFIG["ticket_no_format"])}
        &nbsp Status Assigned
      .col-md-2.small_scale_padding-top8
        %strong Sereial No:#{product.serial_no }
      .col-md-2.pull-right.text-right.small_scale_padding-top8
        %p RE-OPEN  
      .col-md-2.pull-right.text-right.small_scale_padding-top8
        %p RE-ASSIGN

.view_ticket_body
  .row
    .col-md-6
      %p Date Sold:
      %p Sold By:
      %br/
      %p SLA:
      %p SLA Time:
      %p SLA started:
      %p SLA finished:

    .col-md-6.pull-right.text-right
      %strong Priority: #{INOCRM_CONFIG["priority"].key ticket.priority}
      %p Logged By: #{current_user.email}
      %p Logged at: #{DateTime.now.strftime("%Y-%m-%d %H:%M")}

= tab_panel do
  .row
    .col-md-12
      = tab_nav_tab({id: "primary_tab"}, ticket_info: {content: "Ticket info", active_class: "active"}, assign_ticket: {content: "Assign ticket"})
    .col-md-12
      .tab-content
        = tab_content tabpointer: :ticket_info, active_class: "active" do
          = tab_panel do
            .row.small_scale_margin-top1
              .col-md-2.col-xs-12.col-sm-2
                = tab_nav_tab({class: "tabs-left", id: "secondary_tab"}, job_info: {content: "job info", active_class: "active"}, contacts: {content: "Customer"}, warranties: {content: "Warranties"}, history: {content: "history"}, join: {content: "join"}, q_and_a: {content: "Q & A"})
              .col-md-10.col-xs-12.col-sm-10
                .tab-content
                  = tab_content tabpointer: :job_info, active_class: "active" do
                    = render "tickets/job_info", product: product, ticket: ticket
                  = tab_content tabpointer: :contacts do
                    = render "users/view_customer", customer: customer, ticket: ticket
                  = tab_content tabpointer: :warranties do
                    = render "warranties/select_warranties", warranties: warranties
                  = tab_content tabpointer: :history do
                    #histories_pagination
                      = render "tickets/view_histories", histories: histories
                  = tab_content tabpointer: :join do
                    #join_pagination
                      = render "tickets/join", join_tickets: join_tickets, ticket: ticket
                  = tab_content tabpointer: :q_and_a do
                    = render "q_and_as/q_and_a", ge_q_and_as: ge_q_and_as, pr_q_and_as: pr_q_and_answers
          .row
            .col-md-12.col-xs-12.col-sm-12
              = simple_form_for ticket do |f|
                = f.input :remarks, input_html: {value: nil}, placeholder: "Please enter remarks"
                %p= simple_format ticket.remarks
                = f.submit "Update", class: "btn btn-success"

        = tab_content tabpointer: :assign_ticket do
          = simple_form_for ticket do |f|
            .row
              .col-md-12.col-xs-12.col-sm-12
                %br
                = f.association :ticket_type, as: :radio_buttons, wrapper_html: {class: "col-md-3"}, wrapper: :append, input_html: {class: "ticket_type"}
                = f.input :regional_support_job, label: "Regional Support Job", wrapper_html: {class: "col-md-2"}, wrapper: :append
            .row
              .col-md-3.col-xs-12.col-sm-12
                %strong Job type
                = f.select :job_type_id, options_from_collection_for_select(JobType.all, :id, :name), {},{class: "col-md-12 small_scale_margin-top3"}
            .row
            .row
              .col-md-3.col-xs-12.col-sm-12
                = f.submit "Submit", data: {disable_with: "Please wait..."}, class: "btn btn-success small_scale_margin-top2 small_scale_margin-bottom2"
          / .row
          /   .col-md-12
          /     = simple_form_for ticket do |f|
          /       = f.input :remarks, input_html: {value: nil}, placeholder: "Please enter remarks"
          /       %p= simple_format ticket.remarks
          /       = f.submit "Update", class: "btn btn-success"